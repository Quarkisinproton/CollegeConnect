rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Users can create their own profile, and can only read/write their own profile afterwards.
    match /users/{userId} {
      allow read, update: if request.auth != null && request.auth.uid == userId;
      allow create: if request.auth != null;
    }

    match /events/{eventId} {
      // Any authenticated user can view events.
      allow read: if request.auth != null;
      
      // Only users with the 'president' role can create events.
      // This rule reads the user's profile to check their role.
      allow create: if request.auth != null && get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'president';

      // The user who created the event can update or delete it.
      allow update, delete: if request.auth != null && resource.data.createdBy == request.auth.uid;
    }
  }
}
